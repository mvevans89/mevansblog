---
title: Ebola Outbreak in DRC 2018
author: Michelle
date: '2018-05-15'
slug: drc-ebola
categories: []
tags:
  - R
  - leaflet
  - Ebola
description: ''
---

An outbreak of Ebola occurred in the Equator province of the Democratic Republic of Congo in April 2018. The WHO published its first Disease Outbreak News on the outbreak on May 10th and began efforts to conduct ring vaccination around the area. You can read more about it on the [WHO's website on the 2018 Ebola outbreak in the DRC](http://www.who.int/ebola/situation-reports/drc-2018/en/).

Since the start of the outbreak, [Caitlin Rivers](https://www.jhsph.edu/faculty/directory/profile/3525/caitlin-m-rivers), an Assistant Professor at the John Hopkins Center for Health Security has been digitizing the WHO Disease Outbreak Network situations reports and the DRC Ministry of Health mailing list reports and posting the data on her [github repository](https://github.com/cmrivers/ebola_drc).

I've put together some visualizations to explore the data here. This is more of an exploration of the data than a tutorial in how to do so, but all of the code is provided if you want to take a shot at it yourself.

# Last Updated: May 15, 2018

# Packages you'll need

```{r, eval = T, warning = F, message = F}
library(tidyr)
library(sp)
library(leaflet)
library(rgdal)
library(RCurl)
library(ggplot2)
library(dplyr)
library(plotly)
library(ggthemes)
```


# Accessing Github Data

All of the data is in a public github repository that can be accessed within `R`, making it easy to update by simply rendering the document. You need the `RCurl` package to read the `csv` file. To read in a github `csv` file you need click on the "Raw" button to get the url of the raw text file.

```{r}
who.data <- read.csv(text = getURL( "https://raw.githubusercontent.com/cmrivers/ebola_drc/master/who/data.csv"), stringsAsFactors = F, header = T)

who.data$source <- "WHO"

drc.data <- read.csv(text = getURL("https://raw.githubusercontent.com/cmrivers/ebola_drc/master/drc/data.csv"), stringsAsFactors = F, header = T)
drc.data$source <- "MOH"
```

According to the [WHO website](http://www.who.int/csr/don/14-may-2018-ebola-drc/en/), this includes the confirmed, probable, and suspected cases. Deaths are split with an additional category for health care workers. As of 2018-05-14, the data was being reported as cumulative, although the DON reports are not always clear.

```{r}
head(who.data)
```

We can combine this into one data frame to look at data from both sources. I also turn it into tidy, long data to work with it in `ggplot` later.

```{r}
who.data.tidy <- who.data %>%
  mutate(Date = as.Date(as.character(report_date), format = "%Y%m%d")) %>%
  gather(type, number, confirmed_cases:hcw) %>%
  select(Date, health_zone, source, type, number)

moh.data <- drc.data %>%
  mutate(Date = as.Date(as.character(report_date), format = "%Y%m%d")) %>%
  #rename so columns match who
  mutate(deaths = sum(confirmed_deaths,probable_deaths,suspect_deaths, na.rm=T)) %>%
  #drop probable deaths
  select(-probable_deaths, -suspect_deaths, -confirmed_deaths) %>%
  gather(type, number, confirmed_cases:hcw, deaths) %>%
  select(Date, health_zone, source, type, number)

#colnames(who.data.tidy) == colnames(moh.data)
#combine into one
ebola.data <- rbind(who.data.tidy, moh.data)
```

# Epidemic Curve

The epidemic curve shows the number of cases per reporting period. Here, I plot the cumulative cases, which is how the CDC and MOH report them.

```{r}

p <- ebola.data %>%
  dplyr::select(-health_zone) %>%
  group_by(Date, source, type) %>%
  summarise_all(sum, na.rm=T) %>%
  ungroup() %>%
  #shrink labels by wrapping
  mutate(labels = gsub("_", "\n",type)) %>%
    #order labels
  mutate(labels = factor(labels, levels = c("suspect\ncases", "probable\ncases",
                                            "confirmed\ncases", "deaths", "hcw"))) %>%
  ggplot(., aes(x=Date, y = number)) +
  geom_bar(stat="identity", fill = "navyblue", color = NA) +
  theme_minimal()+
  facet_grid(labels~source) +
  theme(strip.text.y = element_text(angle = 0))
  
ggplotly(p) %>%
  layout(margin = list(r=100))
```

As of May 14th, we don't have many reporting dates, so can't say much about the dynamics of the epidemic yet.

# Spatial Distribution of Suspected Cases

The cases are reported by health zone. You can download a shapefile or GeoJSON of the DRC's health zones [here](https://mapforenvironment.org/layer/info/140/DRC-health-zones#4.13/-4.09/21.75).

In the map below, you can toggle between cases reported by the WHO, the DRC Ministry of Health, or both combined.

```{r, message=F}
health.zones <- readOGR("../../static/data/drc-ebola", "healthZones2", stringsAsFactors = F)

#add to health data
who.zone <- who.data %>%
  dplyr::select(-report_date, -source) %>%
  group_by(health_zone) %>%
  summarise_all(sum, na.rm = T) %>%
  ungroup() %>%
  rename(Name = health_zone)

moh.zone <- moh.data %>%
  spread(type, number) %>%
  group_by(health_zone) %>%
  dplyr::select(-source, -Date) %>%
  summarise_all(sum, na.rm = T) %>%
  ungroup() %>%
  select(Name = health_zone, confirmed_cases, probable_cases, suspect_cases, deaths, hcw)

both.zone <- moh.zone %>%
  bind_rows(who.zone) %>%
  group_by(Name) %>%
  summarise_all(sum, na.rm =T) %>%
  ungroup()
```

```{r}
createMap <- function(map.data, case.data){
  new.map <- merge(map.data, case.data, by = "Name", all.x = T)
  #fill in NAs
  new.map@data[is.na(new.map@data)] <- 0
  return(new.map)
}

who.map <- createMap(health.zones, who.zone)
moh.map <- createMap(health.zones, moh.zone)
both.map <- createMap(health.zones, both.zone)
```

```{r}
#create color palette
pal <- colorNumeric("YlOrRd", domain = both.map$suspect_cases)

labels.who <- sprintf(
  "<strong>%s</strong><br/>%g Suspected Cases (WHO) ",
  who.map$Name, who.map$suspect_cases
) %>% lapply(htmltools::HTML)

labels.moh <-  sprintf(
  "<strong>%s</strong><br/>%g Suspected Cases (DRC MOH)",
  moh.map$Name, moh.map$suspect_cases
) %>% lapply(htmltools::HTML)

labels.both <-  sprintf(
  "<strong>%s</strong><br/>%g Suspected Cases (Both)",
  both.map$Name, both.map$suspect_cases
) %>% lapply(htmltools::HTML)
```

```{r}
leaflet(both.map) %>%
    # basemap
    addProviderTiles(providers$OpenStreetMap.HOT) %>%
    addPolygons(color = "gray08", 
                fillOpacity = 0.5, 
                fillColor = ~pal(suspect_cases),
                label = labels.both,
                highlightOptions = highlightOptions(color = "#444444", weight = 2,
                                                  bringToFront = TRUE), 
                group = "Both") %>%
    # add different data source polygons
    addPolygons(data = moh.map,
                color = "gray08", 
                fillOpacity = 0.5, 
                fillColor = ~pal(suspect_cases),
                label = labels.moh,
                highlightOptions = highlightOptions(color = "#444444", weight = 2,
                                                  bringToFront = TRUE), 
                group = "MOH") %>%
    addPolygons(data = who.map,
                color = "gray08", 
                fillOpacity = 0.5, 
                fillColor = ~pal(suspect_cases),
                label = labels.who,
                highlightOptions = highlightOptions(color = "#444444", weight = 2,
                                                  bringToFront = TRUE), 
                group = "WHO") %>%
    # add layer control
    addLayersControl(baseGroups = c("Both", "WHO", "MOH"),
                     options = layersControlOptions(collapsed = F)) %>%
    # add legend
    addLegend(pal = pal, values = ~suspect_cases, opacity = 0.7, title = "Suspected\nCases",
              position = "bottomright") %>%
    # set custom zoom
    setView(lng = 17.1, lat = -1.3, zoom = 7)

```

While the cases so far (as of May 14th 2018) are pretty remote, they are directly up-river from Brazzaville and Kinshasha.

I will try and keep this updated as data comes in. Check the **Last Updated** tag at the top of this post to see when the data was last updated.